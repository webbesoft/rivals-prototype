#!/bin/bash
# Deployment script for Rivals app
# Runs migrations and syncs players after deployment

set -e  # Exit on error

echo "ğŸš€ Starting deployment tasks..."

# Run migrations
echo "ğŸ“¦ Running database migrations..."
uv run python manage.py migrate --noinput

if [ $? -ne 0 ]; then
    echo "âŒ Migration failed!"
    exit 1
fi

echo "âœ… Migrations completed successfully"

# Sync players
echo "ğŸ”„ Syncing players from FPL API..."
uv run python manage.py sync_players

if [ $? -ne 0 ]; then
    echo "âš ï¸  Player sync had errors, but continuing..."
    # Don't fail deployment if player sync has issues (non-critical)
fi

echo "âœ… Deployment tasks completed!"
exit 0
