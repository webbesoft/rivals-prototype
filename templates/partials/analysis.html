{% load date_filters %}
<div class="p-6 bg-white rounded-lg shadow">
  {% if analysis.error %}
  <div class="text-red-600 font-medium">
    Analysis error: {{ analysis.error }}
  </div>
  {% else %}
  <div class="mb-4">
    <h3 class="text-lg font-semibold">
      Team Analysis — GW {{ analysis.current_gameweek }}
    </h3>
    <div class="text-sm text-gray-600">
      Generated: {{ analysis.analysis_timestamp }}
    </div>
  </div>

  <div class="mb-4">
    <h4 class="font-medium">Summary</h4>
    <div class="text-sm text-gray-700">
      <strong>{{ analysis.team_summary.team_name }}</strong> ({{
      analysis.team_summary.manager_name }}) — {{
      analysis.team_summary.total_points }} pts — Bank £{{
      analysis.team_summary.bank }}M
    </div>
  </div>

  <div class="mb-6">
    <h4 class="font-medium">Smart transfer recommendations</h4>
    {% if analysis.transfer_recommendations %}
    <ul class="space-y-3 mt-3">
      {% for rec in analysis.transfer_recommendations %}
      <li class="border rounded p-3">
        <div class="flex justify-between items-start">
          <div>
            <div class="text-sm text-gray-600">
              Out: <strong>{{ rec.transfer_out.name }}</strong> ({{
              rec.transfer_out.position }})
            </div>
            <div class="text-sm text-gray-600 mt-1">
              In: <strong>{{ rec.transfer_in.0.name }}</strong> — {{
              rec.transfer_in.0.team }}
            </div>
            <div class="text-xs text-gray-500 mt-1">{{ rec.reasoning }}</div>
          </div>
          <div class="text-right text-sm">
            <div class="font-semibold">Priority {{ rec.priority_score }}</div>
          </div>
        </div>
      </li>
      {% endfor %}
    </ul>
    {% else %}
    <div class="text-sm text-gray-500">No transfer recommendations found.</div>
    {% endif %}
  </div>

  <div class="mb-4">
    <h4 class="font-medium">Captain suggestions</h4>
    <div class="mt-2 grid grid-cols-1 sm:grid-cols-3 gap-3">
      {% for c in analysis.captain_suggestions %}
      <div class="border rounded p-3 text-center">
        <div class="font-semibold">{{ c.name }}</div>
        <div class="text-xs text-gray-500">{{ c.team }} — {{ c.position }}</div>
        <div class="text-sm text-gray-700">
          {{ c.expected_points_next_gw|floatformat:0 }} pts (proj)
        </div>
      </div>
      {% empty %}
      <div class="text-sm text-gray-500">No captain candidates</div>
      {% endfor %}
    </div>
  </div>

  <div class="mt-4 text-sm text-gray-600">
    <strong>Budget insights:</strong>
    <ul class="list-disc list-inside mt-2">
      {% for insight in analysis.budget_insights %}
      <li>{{ insight }}</li>
      {% endfor %}
    </ul>
  </div>
  {% endif %}
</div>
